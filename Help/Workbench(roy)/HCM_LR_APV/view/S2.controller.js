/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("hcm.mgr.approve.leaverequests.util.Conversions");jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");jQuery.sap.require("sap.ca.ui.message.message");sap.ca.scfld.md.controller.ScfldMasterController.extend("hcm.mgr.approve.leaverequests.view.S2",{extHookChangeFooterButtons:null,onInit:function(){"use strict";this.resourceBundle=this.oApplicationFacade.getResourceBundle();this.oDataModel=this.oApplicationFacade.getODataModel();this._getData();this.registerMasterListBind(this.getList());var c=sap.ui.core.Component.getOwnerIdFor(this.getView());var C=sap.ui.component(c);C.oEventBus.subscribe("hcm.mgr.approve.leaverequests","leaveRequestApproveReject",this._handleApproveRejectCallBack,this);this.oRouter.attachRoutePatternMatched(function(e){if(e.getParameter("name")==="detail"){var b=this.getBindingContextPathFor(e.getParameter("arguments"));var i=this.findItemByContextPath(b);var l=this.getList();var I=l.indexOfItem(i);var n=l.getItems()[I+1];this._sNextDetailPath=n&&n.getBindingContext(this.sModelName).getPath()}},this)},onDataLoaded:function(){if(this.getList().getItems().length<1){if(!sap.ui.Device.system.phone){this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE")}}},_handleApproveRejectCallBack:function(c,e,d){"use strict";var i=this.findItemByContextPath(this._sNextDetailPath);if(i){this.setListItem(i)}else{if(this.getList().getItems().length>1){this.selectFirstItem()}else{this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE")}}},_getData:function(){"use strict";var l=this.getList(),s=new sap.ui.model.Sorter("ChangeDate",true),f=[new sap.ui.model.Filter("FilterGetAllRequests",sap.ui.model.FilterOperator.EQ,1),new sap.ui.model.Filter("TaskDefinitionID",sap.ui.model.FilterOperator.EQ,"")],t=l.getItems()[0].clone();l.bindItems("/LeaveRequestCollection",t,s,f)},getHeaderFooterOptions:function(){"use strict";var o={sI18NMasterTitle:"view.Master.title"};if(this.extHookChangeFooterButtons){o=this.extHookChangeFooterButtons(o)};return o},_handleListSwipe:function(){"use strict";var l=this.getList(),s=l.getSwipedItem(),c=s.getBindingContext(),o=c.getProperty("SAP__Origin"),r=c.getProperty("RequestId"),v=c.getProperty("Version"),d="PREPARE_APPROVE",t="dialog.success.approve",e={};l.swipeOut();e.RequestId=r;e.Version=v;e.Decision=d;e.SAP__Origin=o;e.Comment="";var a=this;this.oDataModel.create("ApplyLeaveRequestDecision?SAP__Origin='"+o+"'&RequestId='"+r+"'&Version="+v+"&Comment=''"+"&Decision='"+d+"'",e,null,function(){sap.ca.ui.message.showMessageToast(a.resourceBundle.getText(t));a.oDataModel.refresh(true)},jQuery.proxy(this._onRequestFailed,this))},_onRequestFailed:function(e){"use strict";sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e.message,details:e.response.body})}});
